<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>å¤©æ°—ã¨å®¶è¨ˆç°¿</title>
  <link rel='stylesheet' href='css/reset.css'>
  <link rel='stylesheet' href='css/style.css'>
  <style>
    /* styles.css ã¨åŒæ§˜ã®CSSã‚¹ã‚¿ã‚¤ãƒ« */
    img {
      width: 90%;
      height: auto;
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }

    .container {
      margin: 0 auto;
      max-width: 1000px;
    }

    .test {
      text-align: center;
      color: blue;
    }

    .place {
      text-align: center;
      font-size: 30px;
      margin-bottom: 40px;
    }

    .now {
      margin: 0 auto;
      margin-bottom: 15px;
      background-color: #afeeee;
      border: 2px solid #ccc;
      min-height: 200px;
      text-align: center;
      max-width: 200px;
    }

    .box {
      height: 150px;
      width: 250px;
      margin: 10px;
      background-color: #afeeee;
      text-align: center;
    }

    .box_container {
      margin: 0 auto;
      max-width: 1000px;
      text-align: center;
      display: flex;
      justify-content: center;
    }

    .center-align {
      text-align: center;
    }

    #expense-form {
      display: inline-block;
    

    }

    #submit-button {
      padding: 10px 20px;
      border: none;
      background-color: #13b5e2;
      color: white;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 8px;
      transition-duration: 0.4s;
    }

    #submit-button:hover {
      background-color: #eb13b5;
    }

      /* ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤§ããã™ã‚‹ */
      label, input, select, span {
      font-size: 20px;
    }
  </style>
</head>
<body>
  <img src="img/tenki.png" alt="">
  <div class="container">
    <h2 class="place"></h2>
    <div class="now">
      <div id="0_monthdate"></div>
      <div id="0_time"></div>
      <div id="0_description"></div>
      <div id="0_temp"></div>
      <div id="0_icon"><img src=""></div>
    </div>
    <div class="box_container">
      <div class="box">
        <div id="1_monthdate"></div>
        <div id="1_time"></div>
        <div id="1_description"></div>
        <div id="1_temp"></div>
        <div id="1_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="2_monthdate"></div>
        <div id="2_time"></div>
        <div id="2_description"></div>
        <div id="2_temp"></div>
        <div id="2_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="3_monthdate"></div>
        <div id="3_time"></div>
        <div id="3_description"></div>
        <div id="3_temp"></div>
        <div id="3_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="4_monthdate"></div>
        <div id="4_time"></div>
        <div id="4_description"></div>
        <div id="4_temp"></div>
        <div id="4_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="5_monthdate"></div>
        <div id="5_time"></div>
        <div id="5_description"></div>
        <div id="5_temp"></div>
        <div id="5_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="6_monthdate"></div>
        <div id="6_time"></div>
        <div id="6_description"></div>
        <div id="6_temp"></div>
        <div id="6_icon"><img src=""></div>
      </div>
      <div class="box">
        <div id="7_monthdate"></div>
        <div id="7_time"></div>
        <div id="7_description"></div>
        <div id="7_temp"></div>
        <div id="7_icon"><img src=""></div>
      </div>
    </div><!-- /box_container -->
  </div><!-- /.container -->
  <img src="img/kakeibo2.png" alt="">

  <div class="center-align">
    <form id="expense-form">
      <label for="date">æ—¥ä»˜:</label>
      <input type="date" id="date" name="date">
      <br>
      <br>

      <label for="item">é …ç›®:ã€€</label>
      <select id="item" name="item">
        <option value="é£Ÿäº‹">ğŸ´é£Ÿäº‹ğŸ´</option>
        <option value="æ—¥ç”¨å“">ğŸ§¹æ—¥ç”¨å“ğŸ§»</option>
        <option value="äº¤é€šè²»">ğŸšäº¤é€šè²»ğŸš—</option>
        <option value="è¡£æœ">ğŸ‘”è¡£æœğŸ‘š</option>
        <option value="äº¤éš›è²»">â¤ï¸äº¤éš›è²»â¤ï¸</option>
        <option value="è¶£å‘³">ğŸ¸è¶£å‘³ğŸ¨ğŸµ</option>
        <option value="ã‚³ã‚¹ãƒ¡">ğŸ§´ã‚³ã‚¹ãƒ¡ğŸ’„</option>
        <option value="to">to</option> <!-- æ–°ãŸã«è¿½åŠ  -->
      </select>
      <br>
      <br>
      <label for="amount">é‡‘é¡:</label>
      <input type="number" id="amount" name="amount" min="0">
      <span>å††</span> <!-- é‡‘é¡ã®è¡¨ç¤ºã«å††ã‚’è¿½åŠ  -->
      <br>
      <br>
      <!-- ãƒœã‚¿ãƒ³ã«ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ -->
      <button type="button" class="styled-button" id="submit-button">è¿½åŠ </button>
    </form>

    <div id="total-amount"></div>

  </div>

  <div id="expenses-list">
    <!-- ã“ã“ã«å®¶è¨ˆç°¿ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebaseã®æ§‹æˆ
    const firebaseConfig = {
      apiKey: "AIzaSyD_xC9EWLjBaooDsBOj3KPMhIqoffTc7Wc",
      authDomain: "kakeibo2-3a6cd.firebaseapp.com",
      databaseURL: "https://kakeibo2-3a6cd-default-rtdb.firebaseio.com",
      projectId: "kakeibo2-3a6cd",
      storageBucket: "kakeibo2-3a6cd.appspot.com",
      messagingSenderId: "872262479811",
      appId: "1:872262479811:web:9a9e916a7ea0a1588b9776"
    };

    // FirebaseåˆæœŸåŒ–
    firebase.initializeApp(firebaseConfig);

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å‚ç…§ã‚’å–å¾—
    const db = firebase.database();
    const dbRef = db.ref("expenses");

    // ãƒœã‚¿ãƒ³è¦ç´ ã‚’å–å¾—
    const submitButton = document.getElementById('submit-button');

    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼åˆæœŸåŒ–
    let counter = 0;

    // åˆè¨ˆé‡‘é¡ã®åˆæœŸåŒ–
    let totalAmount = 0;

    // ãƒœã‚¿ãƒ³ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
    submitButton.addEventListener('click', () => {
      // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ—¥ä»˜ã€é …ç›®ã€é‡‘é¡ã‚’å–å¾—
      const date = document.getElementById('date').value;
      const item = document.getElementById('item').value;
      const amount = parseInt(document.getElementById('amount').value); // é‡‘é¡ã‚’æ•´æ•°ã«å¤‰æ›

      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦3å›ç›®ã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²æ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤º
      counter++;
      if (counter === 3) {
        alert("ãŠé‡‘ä½¿ã„ã™ãæ³¨æ„ï¼");
      }

      // ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ç”Ÿ
      const clickSound = new Audio('./sounds/é¸æŠ2.mp3');
      clickSound.play();

      // Firebase Realtime Databaseã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
      const expenseData = {
        date: date,
        item: item,
        amount: amount
      };
      dbRef.push(expenseData);

      // åˆè¨ˆé‡‘é¡ã‚’æ›´æ–°
      totalAmount += amount;

      // åˆè¨ˆé‡‘é¡ã‚’è¡¨ç¤ºã™ã‚‹è¦ç´ ã«è¡¨ç¤º
      const totalAmountElement = document.getElementById('total-amount');
      totalAmountElement.textContent = `åˆè¨ˆé‡‘é¡: ${totalAmount}å††`;
    });

    // Firebase Realtime Databaseã«ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã®å‡¦ç†
    dbRef.on("child_added", function(snapshot) {
      const expenseData = snapshot.val();
      const key = snapshot.key;
      // è¡¨ç¤ºç”¨ã®å‡¦ç†ã‚’è¿½åŠ 
      const expenseElement = document.createElement("div");
      expenseElement.textContent = `æ—¥ä»˜: ${expenseData.date}, é …ç›®: ${expenseData.item}, é‡‘é¡: ${expenseData.amount}å††`; // é‡‘é¡ã®è¡¨ç¤ºã«å††ã‚’è¿½åŠ 
      
      // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
      const deleteButton = document.createElement("button");
      deleteButton.textContent = "å‰Šé™¤";
      deleteButton.addEventListener("click", () => {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å‰Šé™¤
        dbRef.child(key).remove();
        // è¡¨ç¤ºä¸Šã®å‰Šé™¤
        expenseElement.remove();
      });

      // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¦ç´ ã«è¿½åŠ 
      expenseElement.appendChild(deleteButton);

      document.getElementById("expenses-list").appendChild(expenseElement);
    });

    // ç¾åœ¨ã®å¤©æ°—æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    navigator.geolocation.getCurrentPosition(success, fail);
    function success(pos) {
      const latitude = pos.coords.latitude;
      const longitude = pos.coords.longitude;
      const url = 'https://api.openweathermap.org/data/2.5/forecast';
      const apiKey = '8e7163df3a4123670ee70f11db141a49';
      $.ajax({
        url: url,
        data: {
          appid: apiKey,
          lat: latitude,
          lon: longitude,
          cnt: 8,
          units: 'metric',
          lang: 'ja'
        }
      })
      .done(function (data) {
        console.log(data);
        $('h2').text(data.city.country + 'ï¼š' + data.city.name + 'ã®å¤©æ°—');
        data.list.forEach(function (response, index) {
          const dateTime = new Date(response.dt * 1000);
          const month = dateTime.getMonth() + 1;
          const date = dateTime.getDate();
          const time = dateTime.getHours();
          const temp = Math.round(response.main.temp);
          const description = response.weather[0].description;
          const icon = response.weather[0].icon;
          $('#' + index + '_icon').children('img').attr('src', 'http://openweathermap.org/img/wn/' + icon + '@4x.png');
          $('#' + index + '_time').text('æ—¥ä»˜ï¼š' + month + 'æœˆ' + date + 'æ—¥' + 'ã€€' + time + ':00');
          $('#' + index + '_description').text('å¤©æ°—ï¼š' + description);
          $('#' + index + '_temp').text('æ°—æ¸©ï¼š' + temp + 'Â°C');
        });
      })
      .fail(function () {
        alert('APIã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
      });
    }
    function fail(error) {
      alert('ç¾åœ¨ä½ç½®ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
  </script>
</body>
</html>
